!function(e,t){"use strict";function i(e){var t,i,n=0;for(t=e.length-1;t>=0;t--)i=Math.ceil(Math.max(e.eq(t).height(),+e.eq(t).data("min-height")||0)),i>n&&(n=i);return n}function n(e){var t,i,n,o,a,r=[];for(n=e.length-1;n>=0;n--)for(t=e.eq(n).data("by"),o=0;o<t.length;o++)i=t.eq(o),a=Math.ceil(Math.max(i.height(),+i.data("min-height")||0)),(!r[o]||r[o]<a)&&(r[o]=a);return r}function o(e){var t,i,n;for(t=e.get(0).getBoundingClientRect().bottom,i=1,n=e.length;n>i;i++)if(e.get(i).getBoundingClientRect().top>=t)return i;return e.length}function a(e,t){var i,n,o,a,r;if("byinner"===t)for(a=e.length-1;a>=0;a--)n=e.eq(a).data("by"),n.css("min-height",n.data("min-height")||1);else if("byinners"===t)for(a=e.length-1;a>=0;a--)for(o=e.eq(a).data("by"),r=o.length-1;r>=0;r--)n=o.eq(r),n.css("min-height",n.data("min-height")||1);else if("byitem"===t)for(e.css("min-height",1),a=e.length-1;a>=0;a--)i=e.eq(a),i.css("min-height",i.data("min-height")||1)}function r(e,t,i){var n,o,a,r,s,h;for(n=e.length-1;n>=0;n--)if(a=e.eq(n),h=a.height(),!(h>=t))if("byitem"===i)a.css("min-height",t+a.data("delta"));else if("byinner"===i)r=a.data("by"),r.css("min-height",r.height()+(t-h)+r.data("delta"));else if("byinners"===i)for(s=a.data("by"),o=0;o<s.length;o++)r=s.eq(o),r.css("min-height",t[o]+r.data("delta"))}function s(){var e=Object.prototype.hasOwnProperty;return e.call(t,"devicePixelRatio")?t.devicePixelRatio:e.call(screen,"deviceXDPI")?screen.deviceXDPI/screen.logicalXDPI:void 0}var h="alignelements",d=e(t),l=/android|blackberry|iphone|ipad|ipod|iemobile|opera mini/i.test(navigator.userAgent),c=function(){return function(e,i){var n,o=function(){t.clearTimeout(n),n=t.setTimeout(function(){e()},i)};return o}}(),m=function(t,i){var n=this;n.$element=t,n.opt={items:null,by:null,liquid:!0,useDebounceAfter:35},1===i.length?("boolean"==typeof i[0]&&(n.opt.liquid=i[0]),"string"==typeof i[0]&&(n.opt.by=i[0]),"object"==typeof i[0]&&(n.opt=e.extend(n.opt,i[0]))):2===i.length&&(n.opt.by=i[0],n.opt.liquid=i[1]),n.init()};m.prototype={init:function(){function t(){var t=e(this),i=0;switch(t.css("box-sizing")){case"border-box":i+=parseInt(t.css("border-top-width"),10)+parseInt(t.css("border-bottom-width"),10);case"padding-box":i+=parseInt(t.css("padding-top"),10)+parseInt(t.css("padding-bottom"),10)}t.data("min-height",parseInt(t.css("min-height"),10)),t.data("delta",i)}function i(){var e,t,i=!1;a.opt.liquid&&a.cols!==(e=a.getColCount())&&(i=!0,a.cols=e),a.ratio!==(t=s())&&(i=!0,a.ratio=t),i&&a.align()}var n,o,a=this;if(a.inited&&a.uninit(),a.$items=a.opt.items?a.$element.find(a.opt.items):a.$element.children(),a.$items.length){if(a.opt.by)for(n=a.$items.length-1;n>=0;n--)o=a.$items.eq(n),o.data("by",o.find(a.opt.by)),1===o.data("by").length?a.mode="byinner":o.data("by").length>1&&(a.mode="byinners"),o.data("by").each(t);else a.$items.each(t);a.mode||(a.mode="byitem"),a.cols=a.getColCount(),a.ratio=s(),a.inited=!0,a.align(),(a.$items.length>=a.opt.useDebounceAfter||l)&&(i=c(i,300)),a._onresize=i,d.on("resize."+h,a._onresize)}},uninit:function(){var e,t=this;if(t._onresize&&d.off("resize."+h,t._onresize),"byitem"===t.mode)t.$items.css("min-height","").removeData("min-height delta");else if("byinner"===t.mode||"byinners"===t.mode)for(e=t.$items.length-1;e>=0;e--)t.$items.eq(e).data("by").css("min-height","").removeData("min-height delta");t.$items.removeData("by"),t.inited=!1},destroy:function(){var e=this;e.uninit(),e.$element.removeData(h)},align:function(){var e,t,o=this,s=o.cols,h=0,d=0;a(o.$items,o.mode);do t=o.$items.slice(h,h+s),"byitem"===o.mode||"byinner"===o.mode?(d=i(t,o),r(t,d,o.mode)):"byinners"===o.mode&&(e=n(t,o),r(t,e,o.mode)),h+=s;while(o.$items.length-h>0)},update:function(t){var i=this;e.isPlainObject(t)&&(i.opt=e.extend(i.opt,t)),i.init()},getColCount:function(){return o(this.$items)},getMode:function(){return this.mode}},e.fn[h]=function(t,i){var n=Array.prototype.slice.call(arguments);return this.each(function(){var o,a=e(this);(o=a.data(h))?"string"==typeof t&&o[t]?o[t](i):o.update(t):a.data(h,new m(a,n))})}}(jQuery,window);
